<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order ‚Ä¢ La Madre Coffee & Roastery</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0c0f;
      --bg2:#0f121a;
      --card:rgba(255,255,255,.06);
      --text:#e9ecf1;
      --muted:#aeb6c4;
      --line:rgba(255,255,255,.10);
      --accent:#d6b26e;
      --accent2:#7bd7c9;
      --shadow: 0 22px 70px rgba(0,0,0,.45);
      --r: 18px;
      --max: 1180px;
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --bg2:#ffffff;
      --card:rgba(0,0,0,.04);
      --text:#131722;
      --muted:#5b6576;
      --line:rgba(0,0,0,.10);
      --shadow: 0 22px 70px rgba(15,18,26,.10);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:"Plus Jakarta Sans",system-ui,Segoe UI,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text)}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 16px}

    .top{
      position:sticky;top:0;z-index:10;
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
      background:linear-gradient(to bottom, rgba(10,10,14,.80), rgba(10,10,14,.25));
    }
    [data-theme="light"] .top{
      background:linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,.55));
    }

    .topin{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 0}
    .brand{display:flex;gap:10px;align-items:center;min-width:0}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background: radial-gradient(circle at 30% 30%, rgba(214,178,110,.9), rgba(123,215,201,.25), rgba(255,255,255,.05));
      border:1px solid var(--line);
    }
    .brand h1{margin:0;font-size:14px;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand p{margin:2px 0 0 0;color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .btn{
      padding:10px 14px;border-radius:12px;
      border:1px solid var(--line);
      background: var(--card);
      color:var(--text);
      font-weight:800;
      font-size:13px;
      transition:.2s ease;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{
      border-color:rgba(214,178,110,.55);
      background:linear-gradient(135deg, rgba(214,178,110,.95), rgba(123,215,201,.55));
      color:#0b0c0f;
      box-shadow:0 16px 40px rgba(214,178,110,.18);
    }
    .btn:disabled{opacity:.55;cursor:not-allowed;transform:none}

    main{padding:18px 0 28px}
    .head{display:flex;flex-wrap:wrap;gap:10px;align-items:end;justify-content:space-between;margin:8px 0 14px}
    .head h2{margin:0;font-size:20px}
    .head p{margin:0;color:var(--muted);font-size:13px;line-height:1.4}

    .layout{
      display:grid;
      grid-template-columns: 1.4fr .6fr;
      gap:12px;
      align-items:start;
    }
    @media (max-width: 980px){.layout{grid-template-columns:1fr}}

    .card{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .controls{padding:14px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}

    .search{
      flex:1;min-width:220px;
      display:flex;gap:10px;align-items:center;
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      padding:10px 12px;border-radius:14px;
    }
    [data-theme="light"] .search{background:rgba(0,0,0,.03)}
    .search input{
      width:100%;
      border:0;outline:none;
      background:transparent;color:var(--text);
      font-size:13px;
    }

    .pill{
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      color:var(--muted);
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
    }
    [data-theme="light"] .pill{background:rgba(0,0,0,.03)}
    .pill.active{color:var(--text);border-color:rgba(214,178,110,.55);background:rgba(214,178,110,.12)}

    .grid{
      display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:14px;
    }
    @media (max-width: 780px){.grid{grid-template-columns:1fr}}

    .item{display:flex;gap:12px;padding:12px;border-radius:16px;border:1px solid var(--line);background:rgba(0,0,0,.10)}
    [data-theme="light"] .item{background:rgba(0,0,0,.03)}
    .thumb{
      width:96px;height:96px;border-radius:16px;flex:0 0 96px;
      background:#111;
      border:1px solid var(--line);
      background-size:cover;background-position:center;
    }
    .meta{flex:1;min-width:0}
    .meta h3{margin:0;font-size:14px}
    .meta p{margin:6px 0 0 0;color:var(--muted);font-size:12.5px;line-height:1.35}
    .price{margin-top:8px;font-weight:900;font-size:13px}
    .actions{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
    .qty{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
    }
    .qty button{
      width:26px;height:26px;border-radius:10px;border:0;cursor:pointer;
      background:rgba(255,255,255,.10);color:var(--text);font-weight:900;
    }
    [data-theme="light"] .qty button{background:rgba(0,0,0,.06)}
    .qty span{min-width:18px;text-align:center;font-weight:900}
    .miniBtn{
      padding:8px 10px;border-radius:12px;border:1px solid var(--line);
      background:rgba(255,255,255,.04);cursor:pointer;font-weight:900;font-size:12px
    }
    .miniBtn:hover{background:rgba(255,255,255,.08)}
    .tag{font-size:11px;color:var(--muted);padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:rgba(0,0,0,.10)}
    [data-theme="light"] .tag{background:rgba(0,0,0,.03)}

    .cart{position:sticky;top:74px}
    @media (max-width: 980px){.cart{position:static}}

    .cartin{padding:14px}
    .cart h3{margin:0 0 8px 0;font-size:15px}
    .cartSmall{color:var(--muted);font-size:12.5px;line-height:1.5;margin:0 0 10px 0}
    .cartList{display:flex;flex-direction:column;gap:8px;margin-top:10px}

    .cartRow{
      display:flex;gap:10px;align-items:flex-start;justify-content:space-between;
      padding:10px;border-radius:14px;border:1px solid var(--line);background:rgba(0,0,0,.10)
    }
    [data-theme="light"] .cartRow{background:rgba(0,0,0,.03)}
    .cartRow b{font-size:12.5px}
    .cartRow span{display:block;color:var(--muted);font-size:12px;margin-top:4px}
    .totals{
      margin-top:10px;padding-top:10px;border-top:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;gap:10px
    }
    .totals b{font-size:13px}
    .totals strong{font-size:16px}

    .field{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .field input,.field textarea{
      width:100%;
      border-radius:14px;border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      color:var(--text);
      padding:10px 12px;
      outline:none;
      font-size:13px;
    }
    [data-theme="light"] .field input,[data-theme="light"] .field textarea{background:rgba(0,0,0,.03)}
    .field textarea{min-height:90px;resize:vertical}

    .bar{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .note{margin-top:10px;color:var(--muted);font-size:12px;line-height:1.5}
  </style>
</head>

<body>
  <div class="top">
    <div class="wrap topin">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>Order ‚Ä¢ La Madre</h1>
          <p>Tambah menu ‚Üí total otomatis ‚Üí kirim WhatsApp</p>
        </div>
      </div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end">
        <button class="btn" id="themeBtn" type="button">üåì Mode</button>
        <a class="btn" href="index.html">‚Üê Kembali</a>
        <button class="btn" id="clearBtn" type="button">Reset</button>
      </div>
    </div>
  </div>

  <main class="wrap">
    <div class="head">
      <div>
        <h2>Pilih menu favoritmu</h2>
        <p>Tekan + untuk masuk pesanan. Total akan terhitung otomatis.</p>
      </div>
      <a class="btn primary" href="#checkout">Checkout</a>
    </div>

    <div class="layout">
      <section class="card">
        <div class="controls">
          <div class="row">
            <div class="search">
              üîé <input id="q" placeholder="Cari: latte, fried rice, wings, matcha..." />
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
              <span class="pill active" data-cat="all">Semua</span>
              <span class="pill" data-cat="Rice & Main">Rice & Main</span>
              <span class="pill" data-cat="Noodle & Pasta">Noodle & Pasta</span>
              <span class="pill" data-cat="Light Bites">Light Bites</span>
              <span class="pill" data-cat="Coffee">Coffee</span>
              <span class="pill" data-cat="Non Coffee">Non Coffee</span>
              <span class="pill" data-cat="Signature">Signature</span>
            </div>
          </div>
        </div>
        <div class="grid" id="grid"></div>
      </section>

      <aside class="card cart" id="checkout">
        <div class="cartin">
          <h3>Pesanan kamu</h3>
          <p class="cartSmall">Nama + total + list akan otomatis ikut ke WhatsApp.</p>

          <div class="cartList" id="cartList"></div>

          <div class="totals">
            <b>Total</b>
            <strong id="total">Rp0</strong>
          </div>

          <div class="field">
            <input id="nama" placeholder="Nama (opsional)" />
            <textarea id="catatan" placeholder="Catatan (opsional)"></textarea>
          </div>

          <div class="bar">
            <button class="btn primary" id="waBtn" type="button" disabled>Buat Pesanan (WhatsApp)</button>
            <button class="btn" id="copyBtn" type="button">Copy Ringkasan</button>
          </div>

          <div class="note">
            Ubah nomor WhatsApp tujuan di variabel <b>WA_NUMBER</b>.
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // ===== Theme (shared with index)
    (function(){
      const key = "theme_lamadre";
      const btn = document.getElementById("themeBtn");
      const saved = localStorage.getItem(key);
      if(saved === "light") document.documentElement.setAttribute("data-theme","light");

      btn.addEventListener("click", ()=>{
        const isLight = document.documentElement.getAttribute("data-theme")==="light";
        if(isLight){
          document.documentElement.removeAttribute("data-theme");
          localStorage.setItem(key,"dark");
        }else{
          document.documentElement.setAttribute("data-theme","light");
          localStorage.setItem(key,"light");
        }
      });
    })();

    // ===== CONFIG
    const WA_NUMBER = "6281398686801"; // ganti kalau perlu

    const rupiah = (n) => "Rp" + n.toLocaleString("id-ID");

    // ===== MENU (pakai data yang sudah kamu punya sebelumnya)
    // NOTE: Ini versi ringkas; gunakan MENU dari file kamu sebelumnya agar lengkap.
    // Kalau kamu sudah punya MENU panjang, PASTE MENU lama di sini.
    const MENU = window.MENU_DATA || [
      {id:"espresso", name:"Espresso", price:25000, cat:"Coffee", desc:"Single shot.", image:"https://images.unsplash.com/photo-1511920170033-f8396924c348?auto=format&fit=crop&w=800&q=80"},
      {id:"cappuccino", name:"Cappuccino", price:35000, cat:"Coffee", desc:"Balanced.", image:"https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=800&q=80"},
      {id:"french_fries", name:"French Fries", price:25000, cat:"Light Bites", desc:"Crispy fries.", image:"https://images.unsplash.com/photo-1518013431117-eb1465fa5752?auto=format&fit=crop&w=800&q=80"},
      {id:"kampoeng_fried_rice", name:"Kampoeng Fried Rice", price:40000, cat:"Rice & Main", desc:"Indonesian fried rice.", image:"https://images.unsplash.com/photo-1604909052743-94e838986d24?auto=format&fit=crop&w=800&q=80"},
      {id:"matcha_cold", name:"Matcha (Cold)", price:37000, cat:"Non Coffee", desc:"Non coffee.", image:"https://images.unsplash.com/photo-1515825838458-f2b19e1c7d34?auto=format&fit=crop&w=800&q=80"},
      {id:"sig_leonardo", name:"Signature: Leonardo da Vinci", price:40000, cat:"Signature", desc:"Coffee mocktail.", image:"https://images.unsplash.com/photo-1528735602780-2552fd46c7af?auto=format&fit=crop&w=800&q=80"},
    ];

    // ===== STATE
    const cart = new Map();
    let activeCat = "all";

    // ===== DOM
    const grid = document.getElementById("grid");
    const q = document.getElementById("q");
    const pills = Array.from(document.querySelectorAll(".pill"));
    const cartList = document.getElementById("cartList");
    const totalEl = document.getElementById("total");
    const waBtn = document.getElementById("waBtn");
    const copyBtn = document.getElementById("copyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const namaEl = document.getElementById("nama");
    const catatanEl = document.getElementById("catatan");

    function escapeHtml(s){
      return (s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }

    function getFiltered(){
      const term = (q.value || "").trim().toLowerCase();
      return MENU.filter(m=>{
        const okCat = (activeCat === "all") ? true : (m.cat === activeCat);
        const okTerm = !term ? true : (m.name.toLowerCase().includes(term) || (m.desc||"").toLowerCase().includes(term));
        return okCat && okTerm;
      });
    }

    function renderMenu(){
      const items = getFiltered();
      grid.innerHTML = items.map(m=>{
        const qty = cart.get(m.id) || 0;
        return `
          <div class="item">
            <div class="thumb" style="background-image:url('${m.image}')"></div>
            <div class="meta">
              <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                <h3 style="flex:1;min-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${escapeHtml(m.name)}</h3>
                <span class="tag">${escapeHtml(m.cat)}</span>
              </div>
              <p>${escapeHtml(m.desc || "")}</p>
              <div class="price">${rupiah(m.price)}</div>
              <div class="actions">
                <div class="qty">
                  <button type="button" onclick="dec('${m.id}')">‚àí</button>
                  <span id="q_${m.id}">${qty}</span>
                  <button type="button" onclick="inc('${m.id}')">+</button>
                </div>
                <button class="miniBtn" type="button" onclick="addOne('${m.id}')">Masukkan</button>
              </div>
            </div>
          </div>
        `;
      }).join("");
    }

    function renderCart(){
      const rows = Array.from(cart.entries())
        .filter(([,qty])=>qty>0)
        .map(([id,qty])=>{
          const m = MENU.find(x=>x.id===id);
          const sub = m.price * qty;
          return {m,qty,sub};
        });

      if(rows.length===0){
        cartList.innerHTML = `<div class="note">Belum ada item. Pilih menu di sebelah kiri.</div>`;
      } else {
        cartList.innerHTML = rows.map(r=>`
          <div class="cartRow">
            <div style="min-width:0">
              <b style="display:block;max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${escapeHtml(r.m.name)}</b>
              <span>${r.qty} x ${rupiah(r.m.price)} = <b>${rupiah(r.sub)}</b></span>
            </div>
            <div style="display:flex;gap:6px;align-items:center">
              <button class="miniBtn" type="button" onclick="dec('${r.m.id}')">‚àí</button>
              <button class="miniBtn" type="button" onclick="inc('${r.m.id}')">+</button>
            </div>
          </div>
        `).join("");
      }

      const total = rows.reduce((a,b)=>a+b.sub,0);
      totalEl.textContent = rupiah(total);
      waBtn.disabled = rows.length === 0;
    }

    window.inc = (id)=>{
      cart.set(id, (cart.get(id)||0) + 1);
      syncQty(id);
      renderCart();
    };
    window.dec = (id)=>{
      const v = (cart.get(id)||0) - 1;
      cart.set(id, Math.max(0,v));
      syncQty(id);
      renderCart();
    };
    window.addOne = (id)=> window.inc(id);

    function syncQty(id){
      const el = document.getElementById("q_"+id);
      if(el) el.textContent = cart.get(id)||0;
    }

    function buildMessagePlain(){
      const rows = Array.from(cart.entries())
        .filter(([,qty])=>qty>0)
        .map(([id,qty])=>{
          const m = MENU.find(x=>x.id===id);
          const sub = m.price * qty;
          return {name:m.name, qty, unit:m.price, sub};
        });

      const total = rows.reduce((a,b)=>a+b.sub,0);
      const nama = (namaEl.value||"").trim();
      const catatan = (catatanEl.value||"").trim();

      let text = "Halo La Madre Coffee & Roastery,\n\nSaya ingin pesan:\n";
      rows.forEach(r=>{
        text += `- ${r.name} x${r.qty} (${rupiah(r.unit)}) = ${rupiah(r.sub)}\n`;
      });
      text += `\nTotal: ${rupiah(total)}\n`;
      if(nama) text += `Nama: ${nama}\n`;
      if(catatan) text += `Catatan: ${catatan}\n`;
      text += "\nTerima kasih!";
      return text;
    }

    waBtn.addEventListener("click", ()=>{
      const text = buildMessagePlain();
      const url = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(text)}`;
      window.open(url, "_blank");
    });

    copyBtn.addEventListener("click", async ()=>{
      const text = buildMessagePlain();
      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "Tercopy ‚úì";
        setTimeout(()=>copyBtn.textContent="Copy Ringkasan", 1200);
      }catch(e){
        alert("Gagal copy. Coba manual ya.");
      }
    });

    clearBtn.addEventListener("click", ()=>{
      cart.clear();
      renderMenu();
      renderCart();
    });

    pills.forEach(p=>{
      p.addEventListener("click", ()=>{
        pills.forEach(x=>x.classList.remove("active"));
        p.classList.add("active");
        activeCat = p.dataset.cat;
        renderMenu();
      });
    });

    q.addEventListener("input", ()=>renderMenu());

    renderMenu();
    renderCart();
  </script>
</body>
</html>
