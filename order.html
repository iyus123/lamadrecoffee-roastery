<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Order/Menu ‚Äî La Madre</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0c10;
      --bg2:#0f121a;
      --text:#eef2f7;
      --muted:#aab3c2;
      --line:rgba(255,255,255,.10);
      --card:rgba(255,255,255,.06);
      --glass:rgba(0,0,0,.25);
      --accent:#d7b56f;
      --accent2:#7bd7c9;
      --shadow: 0 26px 90px rgba(0,0,0,.50);
      --r:22px;
      --safeB: env(safe-area-inset-bottom, 0px);
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --bg2:#ffffff;
      --text:#151a24;
      --muted:#5d6778;
      --line:rgba(0,0,0,.10);
      --card:rgba(0,0,0,.04);
      --glass:rgba(255,255,255,.70);
      --shadow: 0 18px 70px rgba(16,20,30,.12);
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:"Plus Jakarta Sans",system-ui,Segoe UI,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg),var(--bg2));
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    button,input,textarea{font-family:inherit}

    .wrap{width:100%;max-width:1120px;margin:0 auto;padding:0 18px}
    @media (min-width:1200px){.wrap{max-width:1280px;padding:0 24px}}

    /* NAV */
    .nav{
      position:sticky;top:0;z-index:50;
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(12px);
      background:linear-gradient(to bottom, rgba(10,12,18,.82), rgba(10,12,18,.30));
    }
    [data-theme="light"] .nav{
      background:linear-gradient(to bottom, rgba(255,255,255,.90), rgba(255,255,255,.60));
    }
    .navin{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 0}
    .brand{display:flex;gap:12px;align-items:center;min-width:0}
    .logoImg{
      width:46px;height:46px;border-radius:18px;object-fit:cover;
      border:1px solid var(--line);
      box-shadow:0 18px 45px rgba(215,181,111,.18);
      flex:0 0 46px;background:#000;
    }
    .brandTxt{min-width:0}
    .brand h1{
      margin:0;font-size:15px;line-height:1.1;font-weight:900;
      letter-spacing:-.02em;text-transform:uppercase;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .brand p{margin:3px 0 0;color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .right{display:flex;gap:10px;align-items:center;justify-content:flex-end;flex-wrap:wrap}

    .btn{
      padding:10px 14px;border-radius:14px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--text);
      font-weight:800;font-size:13px;
      cursor:pointer;
      transition:.18s ease;
      user-select:none;
      display:inline-flex;align-items:center;gap:8px;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0) scale(.98)}
    .btn.primary{
      border-color:rgba(215,181,111,.55);
      background:linear-gradient(135deg, rgba(215,181,111,.98), rgba(123,215,201,.55));
      color:#0b0c10;
      box-shadow:0 16px 40px rgba(215,181,111,.18);
    }

    .desktopOnly{display:flex}
    .hamb{
      display:none;
      width:44px;height:44px;border-radius:16px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--text);
      cursor:pointer;font-weight:900;font-size:18px;
      transition:.18s ease;
    }
    .hamb:hover{transform:translateY(-1px)}
    .hamb:active{transform:translateY(0) scale(.98)}
    .mobileMenu{
      display:none;
      border-top:1px solid var(--line);
      background:linear-gradient(to bottom, rgba(10,12,18,.82), rgba(10,12,18,.50));
      backdrop-filter: blur(12px);
    }
    [data-theme="light"] .mobileMenu{
      background:linear-gradient(to bottom, rgba(255,255,255,.90), rgba(255,255,255,.74));
    }
    .mobileMenu .full{
      width:100%;
      border-radius:0;border-left:0;border-right:0;border-top:0;
      padding:14px 18px;
      justify-content:flex-start;
    }
    @media (max-width:720px){
      .brand p{display:none}
      .desktopOnly{display:none}
      .hamb{display:inline-flex;align-items:center;justify-content:center}
      .mobileMenu.open{display:block}
    }

    /* PAGE */
    .page{padding:18px 0 18px}
    .hint{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.6}

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:14px;
      align-items:start;
      padding-bottom: calc(92px + var(--safeB));
    }
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .panel{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:var(--r);
      padding:16px;
      box-shadow:var(--shadow);
    }
    [data-theme="light"] .panel{box-shadow: 0 18px 70px rgba(16,20,30,.10)}

    .panel h2{margin:0 0 6px;font-size:15px;font-weight:900}
    .panel p{margin:0;color:var(--muted);font-size:12.8px;line-height:1.6}

    /* FILTER */
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 14px}
    .pill{
      padding:9px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      font-weight:900;font-size:12.5px;
      cursor:pointer;transition:.18s ease;
    }
    [data-theme="light"] .pill{background:rgba(0,0,0,.03)}
    .pill:hover{transform:translateY(-1px)}
    .pill.active{
      color:#0b0c10;
      background:linear-gradient(135deg, rgba(215,181,111,.98), rgba(123,215,201,.55));
      border-color:rgba(215,181,111,.55);
    }
    [data-theme="light"] .pill.active{color:#101522}

    /* MENU */
    .menuGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.menuGrid{grid-template-columns:1fr}}
    .item{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      border-radius:18px;
      padding:14px;
      display:flex;flex-direction:column;gap:10px;
      min-height:132px;
    }
    [data-theme="light"] .item{background:rgba(0,0,0,.03)}
    .itemTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .iname{margin:0;font-size:14px;font-weight:900;line-height:1.2}
    .idesc{margin:4px 0 0;color:var(--muted);font-size:12px;line-height:1.45}
    .iprice{font-weight:1000;font-size:13px;white-space:nowrap}

    .itemBottom{margin-top:auto;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .qty{
      display:inline-flex;align-items:center;gap:10px;
      padding:8px 10px;border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
    }
    [data-theme="light"] .qty{background:rgba(0,0,0,.04)}
    .qbtn{
      width:32px;height:32px;border-radius:12px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--text);
      cursor:pointer;font-weight:1000;
    }
    .qbtn:active{transform:scale(.98)}
    .qnum{min-width:18px;text-align:center;font-weight:1000}

    .addBtn{
      padding:10px 12px;border-radius:14px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
    }
    .addBtn:hover{transform:translateY(-1px)}
    .addBtn:active{transform:translateY(0) scale(.98)}

    .noteMini{margin-top:12px;color:var(--muted);font-size:12px;line-height:1.5}

    /* CART */
    .cartBox{display:flex;flex-direction:column;gap:12px}
    .cartList{
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      border-radius:18px;
      padding:12px;
      min-height:120px;
    }
    [data-theme="light"] .cartList{background:rgba(0,0,0,.03)}
    .empty{color:var(--muted);font-size:12.8px;line-height:1.6}
    .cRow{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;padding:10px 8px;border-bottom:1px solid var(--line)}
    .cRow:last-child{border-bottom:0}
    .cName{font-weight:1000;font-size:13px;line-height:1.25;margin:0}
    .cMeta{color:var(--muted);font-size:12px;margin-top:3px}
    .cRight{text-align:right;white-space:nowrap}
    .cRight b{display:block}
    .cRight small{color:var(--muted)}

    .totalBox{
      display:flex;justify-content:space-between;align-items:center;
      padding:12px 14px;border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
    }
    [data-theme="light"] .totalBox{background:rgba(0,0,0,.03)}
    .totalBox span{color:var(--muted);font-weight:900}
    .totalBox b{font-size:16px;font-weight:1000}

    .field{
      width:100%;
      padding:12px 12px;border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      color:var(--text);
      outline:none;font-weight:800;
    }
    [data-theme="light"] .field{background:rgba(0,0,0,.03)}
    textarea.field{min-height:96px;resize:vertical;font-weight:700}

    /* PAYMENT CLICK */
    .payWrap{
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      border-radius:18px;
      padding:12px;
      display:flex;flex-direction:column;gap:10px;
    }
    [data-theme="light"] .payWrap{background:rgba(0,0,0,.03)}
    .payTitle{margin:0;font-size:12.8px;color:var(--muted);font-weight:900}
    .payRow{display:flex;gap:8px;flex-wrap:wrap}
    .payBtn{
      flex:1;min-width:140px;
      padding:12px 12px;border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      transition:.18s ease;
    }
    [data-theme="light"] .payBtn{background:rgba(0,0,0,.03)}
    .payBtn:hover{transform:translateY(-1px)}
    .payBtn.active{
      border-color:rgba(215,181,111,.55);
      background:linear-gradient(135deg, rgba(215,181,111,.98), rgba(123,215,201,.55));
      color:#0b0c10;
    }
    .payBtn .tag{font-size:12px;opacity:.9;font-weight:1000}
    .helpSmall{font-size:12px;color:var(--muted);line-height:1.55;margin:0}

    /* BOTTOM BAR */
    .bottomBar{
      position:fixed;left:0;right:0;bottom:0;z-index:60;
      border-top:1px solid var(--line);
      backdrop-filter: blur(12px);
      background:linear-gradient(to top, rgba(10,12,18,.88), rgba(10,12,18,.55));
      padding:10px 0 calc(10px + var(--safeB));
    }
    [data-theme="light"] .bottomBar{
      background:linear-gradient(to top, rgba(255,255,255,.92), rgba(255,255,255,.70));
    }
    .bb{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .bbLeft{min-width:180px;display:flex;flex-direction:column;gap:2px}
    .bbTotal{font-size:12.5px;color:var(--muted);font-weight:900}
    .bbTotal b{color:var(--text);font-size:13.5px}
    .bbCount{color:var(--muted);font-size:12px}
    .bbRight{display:flex;gap:8px;align-items:center;justify-content:flex-end;flex-wrap:wrap}
    @media (max-width:720px){
      .bb{align-items:flex-start}
      .bbRight .btn{padding:10px 12px;border-radius:14px;font-size:12.5px}
    }

    /* QR MODAL */
    .modal{
      position:fixed;inset:0;z-index:80;
      display:none;align-items:center;justify-content:center;
      padding:18px;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
    }
    .modal.open{display:flex}
    .modalCard{
      width:min(560px, 100%);
      border-radius:22px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.20));
      box-shadow: 0 40px 140px rgba(0,0,0,.65);
      overflow:hidden;
    }
    [data-theme="light"] .modalCard{
      background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
      box-shadow: 0 30px 110px rgba(16,20,30,.18);
    }
    .modalHead{
      padding:14px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid var(--line);
    }
    .modalHead b{font-size:14px;font-weight:1000}
    .xBtn{
      width:44px;height:44px;border-radius:16px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--text);
      cursor:pointer;font-size:18px;font-weight:1000;
    }
    .modalBody{padding:14px}
    .qrBox{
      border:1px solid var(--line);
      background:rgba(0,0,0,.10);
      border-radius:18px;
      padding:14px;
      display:grid;
      gap:12px;
      place-items:center;
    }
    [data-theme="light"] .qrBox{background:rgba(0,0,0,.03)}
    .qrImg{
      width:min(420px, 100%);
      aspect-ratio:1/1;
      border-radius:16px;
      object-fit:contain;
      background:#fff;
      padding:10px;
      border:1px solid rgba(0,0,0,.08);
    }
    .payTotal{
      width:100%;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:12px 14px;border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
    }
    [data-theme="light"] .payTotal{background:rgba(0,0,0,.03)}
    .payTotal span{color:var(--muted);font-weight:900}
    .payTotal b{font-size:16px;font-weight:1000}
    .modalNote{margin:12px 2px 0;color:var(--muted);font-size:12.3px;line-height:1.6}

    /* PRINT */
    @media print{
      body{background:#fff;color:#111}
      .nav,.page,.bottomBar,.modal{display:none !important}
      .printArea{display:block !important}
    }
    .printArea{display:none}
    .receipt{
      padding:18px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .receipt h1{margin:0 0 8px;font-size:18px}
    .receipt .muted{color:#444;font-size:12px}
    .rLine{margin:10px 0;border-top:1px dashed #999}
    .rRow{display:flex;justify-content:space-between;gap:10px;font-size:12.5px;margin:6px 0}
    .rRow b{font-weight:900}
  </style>
</head>

<body>
  <!-- NAV -->
  <div class="nav">
    <div class="wrap navin">
      <div class="brand">
        <img class="logoImg" src="logo-lamadre.png" alt="La Madre Logo">
        <div class="brandTxt">
          <h1>LA MADRE COFFEE &amp; ROASTERY</h1>
          <p>Order/Menu</p>
        </div>
      </div>

      <div class="right desktopOnly">
        <button class="btn" id="themeBtn" type="button">üåì Mode</button>
        <a class="btn" href="index.html">üè† Home</a>
        <button class="btn" id="summaryBtn" type="button">üßæ Ringkasan</button>
      </div>

      <button class="hamb" id="hambBtn" type="button" aria-label="Buka menu" aria-expanded="false">‚ò∞</button>
    </div>

    <div class="mobileMenu" id="mobileMenu">
      <button class="btn full" id="themeBtnM" type="button">üåì Mode Gelap/Terang</button>
      <a class="btn full" href="index.html">üè† Home</a>
      <button class="btn full" id="summaryBtnM" type="button">üßæ Ringkasan</button>
    </div>
  </div>

  <main class="page">
    <div class="wrap">
      <p class="hint">
        Pilih menu, atur jumlah, lalu klik <b>Buat Pesanan</b>.
        Kamu bisa <b>Cetak Struk (PDF)</b> dan (jika pilih QRIS) QR akan muncul di popup.
      </p>

      <div class="grid">
        <!-- LEFT -->
        <section class="panel">
          <h2>Menu Pilihan</h2>
          <p>Klik + / ‚àí untuk mengatur jumlah. Klik ‚ÄúTambah‚Äù untuk memasukkan ke pesanan.</p>

          <div class="filters" id="filters"></div>
          <div class="menuGrid" id="menuGrid"></div>

          <div class="noteMini">*Menu & harga bisa kamu edit di bagian <b>const MENU</b> pada script.</div>
        </section>

        <!-- RIGHT -->
        <aside class="panel cartBox" id="cartPanel">
          <h2>Pesanan Kamu</h2>
          <p>Ringkasan item yang kamu pilih.</p>

          <div class="cartList" id="cartList">
            <div class="empty">Belum ada pesanan. Silakan pilih menu di sebelah kiri.</div>
          </div>

          <div class="totalBox">
            <span>Total</span>
            <b id="totalText">Rp 0</b>
          </div>

          <input class="field" id="buyerName" placeholder="Nama pemesan (wajib)" />
          <textarea class="field" id="notes" placeholder="Catatan (opsional)"></textarea>

          <div class="payWrap">
            <div class="payTitle">Metode pembayaran (klik untuk pilih)</div>
            <div class="payRow">
              <button class="payBtn active" id="payCash" type="button">
                <span>üíµ Bayar di tempat</span><span class="tag">Cash</span>
              </button>
              <button class="payBtn" id="payQris" type="button">
                <span>üì± QRIS</span><span class="tag">Scan</span>
              </button>
            </div>

            <p class="helpSmall" id="payHelp">Bayar di tempat: kamu pesan dulu, nanti bayar di kasir.</p>

            <button class="btn" id="showQrisBtn" type="button" style="justify-content:center">
              üîé Lihat QRIS
            </button>
          </div>

          <p class="helpSmall">
            Setelah klik ‚ÄúBuat Pesanan‚Äù, WhatsApp akan terbuka dengan detail item + jumlah + total + metode bayar.
          </p>
        </aside>
      </div>
    </div>
  </main>

  <!-- Bottom Bar -->
  <div class="bottomBar">
    <div class="wrap bb">
      <div class="bbLeft">
        <div class="bbTotal">Total: <b id="bbTotalText">Rp 0</b></div>
        <div class="bbCount" id="bbCountText">0 item dipilih</div>
      </div>

      <div class="bbRight">
        <button class="btn" id="bbPrint" type="button">üßæ Cetak Struk (PDF)</button>
        <button class="btn" id="bbReset" type="button">‚Ü∫ Reset</button>
        <button class="btn" id="bbBack" type="button">‚Üê Kembali</button>
        <button class="btn primary" id="bbOrder" type="button">üü¢ Buat Pesanan</button>
      </div>
    </div>
  </div>

  <!-- QRIS Modal -->
  <div class="modal" id="qrisModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-label="QRIS Pembayaran">
      <div class="modalHead">
        <b>QRIS ‚Äî La Madre Coffee &amp; Roastery</b>
        <button class="xBtn" id="qrisClose" type="button" aria-label="Tutup">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="qrBox">
          <img class="qrImg" id="qrisImg" src="qris-lamadre.png" alt="QRIS La Madre">
          <div class="payTotal">
            <span>Total yang dibayar</span>
            <b id="qrisTotalText">Rp 0</b>
          </div>
        </div>
        <div class="modalNote">
          Scan QRIS di atas, pastikan nominal sesuai total. Setelah bayar, lanjut klik <b>Buat Pesanan</b> agar order tercatat di WhatsApp.
        </div>
      </div>
    </div>
  </div>

  <!-- Print area -->
  <div class="printArea" id="printArea">
    <div class="receipt" id="receipt"></div>
  </div>

  <script>
    // ================= CONFIG =================
    const WA_NUMBER = "6281398686801";
    const QRIS_IMAGE = "qris-lamadre.png";

    // ================= MENU (EDIT) =================
    const MENU = [
      { id:"espresso", name:"Espresso", desc:"Single shot, bold & clean.", price:20000, cat:"Coffee" },
      { id:"americano", name:"Americano", desc:"Long black, light & smooth.", price:25000, cat:"Coffee" },
      { id:"latte", name:"Cafe Latte", desc:"Creamy milk & espresso.", price:32000, cat:"Coffee" },
      { id:"butterscotch", name:"Butterscotch Latte", desc:"Sweet, creamy, crowd favorite.", price:36000, cat:"Coffee" },
      { id:"matcha", name:"Matcha Latte", desc:"Earthy, creamy matcha.", price:32000, cat:"Non Coffee" },
      { id:"fries", name:"French Fries", desc:"Crispy fries, perfect snack.", price:25000, cat:"Snacks" },
      { id:"toast", name:"Bread Toast", desc:"Toasted bread with topping.", price:28000, cat:"Snacks" },
      { id:"grillchicken", name:"Grilled Chicken Rice", desc:"Comfort food for lunch/dinner.", price:45000, cat:"Food" },
    ];

    // ================= STATE =================
    const cart = {};           // { id: qty }
    let activeCat = "Semua Kategori";
    let payment = "Cash";      // Cash | QRIS

    // ================= SAFE HELPERS =================
    function $(id){ return document.getElementById(id); }
    function onClick(id, fn){
      const el = $(id);
      if(!el) return;
      el.addEventListener("click", fn);
    }

    function rupiah(n){
      const s = Math.round(n).toString();
      const parts = [];
      for(let i=s.length; i>0; i-=3){
        const start = Math.max(i-3, 0);
        parts.unshift(s.slice(start,i));
      }
      return "Rp " + parts.join(".");
    }

    function getItems(){
      return Object.entries(cart)
        .filter(([_,q]) => q>0)
        .map(([id,q])=>{
          const item = MENU.find(m=>m.id===id);
          return { ...item, qty:q, subtotal:item.price*q };
        });
    }
    function getTotal(){ return getItems().reduce((a,b)=>a+b.subtotal,0); }
    function getCount(){ return getItems().reduce((a,b)=>a+b.qty,0); }

    // ================= THEME =================
    function initTheme(){
      const key = "theme_lamadre";
      function applySaved(){
        const saved = localStorage.getItem(key);
        if(saved === "light") document.documentElement.setAttribute("data-theme","light");
        else document.documentElement.removeAttribute("data-theme");
      }
      function toggle(){
        const isLight = document.documentElement.getAttribute("data-theme")==="light";
        if(isLight){
          document.documentElement.removeAttribute("data-theme");
          localStorage.setItem(key,"dark");
        }else{
          document.documentElement.setAttribute("data-theme","light");
          localStorage.setItem(key,"light");
        }
      }
      applySaved();
      onClick("themeBtn", toggle);
      onClick("themeBtnM", toggle);
    }

    // ================= MOBILE MENU =================
    function initMobileMenu(){
      const hambBtn = $("hambBtn");
      const mobileMenu = $("mobileMenu");
      if(!hambBtn || !mobileMenu) return;

      hambBtn.addEventListener("click", ()=>{
        const open = mobileMenu.classList.toggle("open");
        hambBtn.setAttribute("aria-expanded", open ? "true" : "false");
        hambBtn.textContent = open ? "‚úï" : "‚ò∞";
      });

      mobileMenu.addEventListener("click", (e)=>{
        if(e.target.tagName === "A" || e.target.tagName === "BUTTON"){
          mobileMenu.classList.remove("open");
          hambBtn.setAttribute("aria-expanded","false");
          hambBtn.textContent = "‚ò∞";
        }
      });
    }

    // ================= FILTERS =================
    function buildFilters(){
      const filtersEl = $("filters");
      if(!filtersEl) return;

      const cats = ["Semua Kategori", ...Array.from(new Set(MENU.map(m=>m.cat)))];
      filtersEl.innerHTML = "";

      cats.forEach(cat=>{
        const b = document.createElement("button");
        b.type = "button";
        b.className = "pill" + (cat===activeCat ? " active":"");
        b.textContent = cat;
        b.addEventListener("click", ()=>{
          activeCat = cat;
          buildFilters();
          renderMenu();
        });
        filtersEl.appendChild(b);
      });
    }

    // ================= MENU RENDER =================
    function renderMenu(){
      const grid = $("menuGrid");
      if(!grid) return;

      const show = (activeCat==="Semua Kategori")
        ? MENU
        : MENU.filter(m=>m.cat===activeCat);

      grid.innerHTML = "";

      show.forEach(item=>{
        const q = cart[item.id] || 0;

        const card = document.createElement("div");
        card.className = "item";
        card.innerHTML = `
          <div class="itemTop">
            <div>
              <p class="iname">${item.name}</p>
              <p class="idesc">${item.desc || ""}</p>
            </div>
            <div class="iprice">${rupiah(item.price)}</div>
          </div>

          <div class="itemBottom">
            <div class="qty">
              <button class="qbtn" type="button" aria-label="Kurangi">‚àí</button>
              <div class="qnum" id="q_${item.id}">${q}</div>
              <button class="qbtn" type="button" aria-label="Tambah">+</button>
            </div>
            <button class="addBtn" type="button">Tambah</button>
          </div>
        `;

        const btns = card.querySelectorAll(".qbtn");
        const minusBtn = btns[0];
        const plusBtn  = btns[1];
        const addBtn   = card.querySelector(".addBtn");

        minusBtn.addEventListener("click", ()=>{
          cart[item.id] = Math.max(0, (cart[item.id]||0) - 1);
          renderMenu();
          renderCart();
        });
        plusBtn.addEventListener("click", ()=>{
          cart[item.id] = (cart[item.id]||0) + 1;
          renderMenu();
          renderCart();
        });
        addBtn.addEventListener("click", ()=>{
          if((cart[item.id]||0) === 0) cart[item.id] = 1;
          renderMenu();
          renderCart();
        });

        grid.appendChild(card);
      });
    }

    // ================= CART RENDER =================
    function renderCart(){
      const list = $("cartList");
      if(!list) return;

      const total = getTotal();
      const count = getCount();

      if($("totalText")) $("totalText").textContent = rupiah(total);
      if($("bbTotalText")) $("bbTotalText").textContent = rupiah(total);
      if($("bbCountText")) $("bbCountText").textContent = `${count} item dipilih`;
      if($("qrisTotalText")) $("qrisTotalText").textContent = rupiah(total);

      const items = getItems();
      if(items.length === 0){
        list.innerHTML = `<div class="empty">Belum ada pesanan. Silakan pilih menu di sebelah kiri.</div>`;
        return;
      }

      list.innerHTML = "";
      items.forEach(it=>{
        const row = document.createElement("div");
        row.className = "cRow";
        row.innerHTML = `
          <div>
            <p class="cName">${it.name}</p>
            <div class="cMeta">${it.qty} x ${rupiah(it.price)}</div>
          </div>
          <div class="cRight">
            <b>${rupiah(it.subtotal)}</b>
            <small>${it.cat}</small>
          </div>
        `;
        list.appendChild(row);
      });
    }

    // ================= PAYMENT =================
    function setPayment(type){
      payment = type;

      const cashBtn = $("payCash");
      const qrisBtn = $("payQris");
      const help = $("payHelp");

      if(type==="Cash"){
        cashBtn && cashBtn.classList.add("active");
        qrisBtn && qrisBtn.classList.remove("active");
        help && (help.textContent = "Bayar di tempat: kamu pesan dulu, nanti bayar di kasir.");
      }else{
        qrisBtn && qrisBtn.classList.add("active");
        cashBtn && cashBtn.classList.remove("active");
        help && (help.textContent = "QRIS: klik Lihat QRIS untuk tampilkan QR, scan sesuai total, lalu klik Buat Pesanan.");
      }
    }

    // ================= QRIS MODAL =================
    function openQris(){
      renderCart();
      const modal = $("qrisModal");
      if(!modal) return;
      modal.classList.add("open");
      modal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeQris(){
      const modal = $("qrisModal");
      if(!modal) return;
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    // ================= ORDER WA =================
    function buildOrderText(){
      const name = ($("buyerName")?.value || "").trim();
      const note = ($("notes")?.value || "").trim();
      const items = getItems();
      const total = getTotal();

      let msg = `Halo La Madre Coffee & Roastery, saya ingin order.%0A%0A`;
      msg += `Nama: ${encodeURIComponent(name)}%0A`;
      msg += `Metode bayar: ${encodeURIComponent(payment)}%0A%0A`;
      msg += `Detail pesanan:%0A`;

      items.forEach(it=>{
        msg += `- ${encodeURIComponent(it.name)} x${it.qty} = ${encodeURIComponent(rupiah(it.subtotal))}%0A`;
      });

      msg += `%0ATotal: ${encodeURIComponent(rupiah(total))}%0A`;

      if(note){
        msg += `%0ACatatan: ${encodeURIComponent(note)}%0A`;
      }

      msg += `%0ATerima kasih.`;
      return msg;
    }

    function sendOrder(){
      const count = getCount();
      if(count === 0){
        alert("Pesanan masih kosong. Pilih menu dulu ya.");
        return;
      }
      const name = ($("buyerName")?.value || "").trim();
      if(!name){
        alert("Nama pemesan wajib diisi ya.");
        $("buyerName")?.focus();
        return;
      }

      // QRIS popup opsional (user request: QR muncul saat klik)
      // Jadi kita tidak paksa otomatis buka, tapi user bisa klik "Lihat QRIS".
      const text = buildOrderText();
      const url = `https://wa.me/${WA_NUMBER}?text=${text}`;
      window.open(url, "_blank");
    }

    // ================= RECEIPT PDF (PRINT) =================
    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function buildReceiptHTML(){
      const name = escapeHTML((($("buyerName")?.value)||"").trim());
      const note = escapeHTML((($("notes")?.value)||"").trim());
      const items = getItems();
      const total = getTotal();
      const dt = new Date().toLocaleString("id-ID");

      let html = `
        <h1>La Madre Coffee &amp; Roastery</h1>
        <div class="muted">Bukti Pesanan (Cetak / Save as PDF)</div>
        <div class="muted">${escapeHTML(dt)}</div>
        <div class="rLine"></div>

        <div class="rRow"><span>Nama</span><b>${name || "-"}</b></div>
        <div class="rRow"><span>Metode bayar</span><b>${escapeHTML(payment)}</b></div>
        <div class="rLine"></div>
      `;

      items.forEach(it=>{
        html += `
          <div class="rRow">
            <span>${escapeHTML(it.name)} x${it.qty}</span>
            <b>${escapeHTML(rupiah(it.subtotal))}</b>
          </div>
        `;
      });

      html += `<div class="rLine"></div>`;
      html += `<div class="rRow"><span>TOTAL</span><b>${escapeHTML(rupiah(total))}</b></div>`;

      if(note){
        html += `<div class="rLine"></div>`;
        html += `<div class="muted">Catatan:</div>`;
        html += `<div style="font-size:12.5px;margin-top:6px">${note}</div>`;
      }

      html += `<div class="rLine"></div>`;
      html += `<div class="muted">Terima kasih. Enjoy!</div>`;
      return html;
    }

    function printReceipt(){
      const count = getCount();
      if(count === 0){
        alert("Pesanan masih kosong. Pilih menu dulu untuk cetak struk.");
        return;
      }
      const receipt = $("receipt");
      if(receipt) receipt.innerHTML = buildReceiptHTML();
      window.print();
    }

    // ================= INIT =================
    window.addEventListener("DOMContentLoaded", ()=>{
      // set QR image
      const qi = $("qrisImg");
      if(qi) qi.src = QRIS_IMAGE;

      initTheme();
      initMobileMenu();

      buildFilters();
      renderMenu();
      renderCart();
      setPayment("Cash");

      // payment click
      onClick("payCash", ()=>setPayment("Cash"));
      onClick("payQris", ()=>setPayment("QRIS"));

      // qris modal
      onClick("showQrisBtn", ()=>{
        if(getCount() === 0){
          alert("Pilih menu dulu supaya totalnya muncul di QRIS.");
          return;
        }
        openQris();
      });
      onClick("qrisClose", closeQris);
      const modal = $("qrisModal");
      if(modal){
        modal.addEventListener("click", (e)=>{
          if(e.target === modal) closeQris();
        });
      }
      document.addEventListener("keydown", (e)=>{
        if(e.key === "Escape") closeQris();
      });

      // summary scroll
      const goSummary = ()=>{
        $("cartPanel")?.scrollIntoView({behavior:"smooth", block:"start"});
      };
      onClick("summaryBtn", goSummary);
      onClick("summaryBtnM", goSummary);

      // bottom bar buttons
      onClick("bbOrder", sendOrder);
      onClick("bbPrint", printReceipt);
      onClick("bbBack", ()=>history.back());
      onClick("bbReset", ()=>{
        for(const k in cart) delete cart[k];
        if($("buyerName")) $("buyerName").value = "";
        if($("notes")) $("notes").value = "";
        closeQris();
        setPayment("Cash");
        activeCat = "Semua Kategori";
        buildFilters();
        renderMenu();
        renderCart();
      });
    });
  </script>
</body>
</html>
